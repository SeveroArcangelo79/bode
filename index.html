<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Representación de Patrones Polares</title><script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script><style>body{margin:0;padding:0;font-family:Arial,sans-serif;background-color:#F0F0F0;height:100vh;display:flex;overflow:hidden;color:#000}#main_widget{display:flex;width:100%;height:100%;padding:10px;box-sizing:border-box;gap:10px}#controls_panel{width:400px;min-width:400px;display:flex;flex-direction:column;gap:15px;background-color:#F0F0F0}#title_label{text-align:center;font-size:20px;font-weight:700;margin-bottom:5px}.group-box{border:1px solid #AAA;border-radius:4px;padding:10px;background-color:#F0F0F0}.group-box legend{font-size:14px;padding:0 5px;color:#333}#visibility_layout{display:flex;flex-direction:column;gap:5px}#style_layout{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center}#style_layout .header{font-weight:700;text-align:center}#style_layout .label-col{text-align:left}.color-btn{width:60px;height:25px;border:1px solid #888;cursor:pointer}.style-btn{width:80px;height:25px;cursor:pointer;background:#E1E1E1;border:1px solid #ADADAD;border-radius:2px}.style-btn:hover{background:#D4D4D4}#linewidth_layout{display:flex;align-items:center;gap:10px}input[type=range]{flex-grow:1}#linewidth_label{width:35px;text-align:right}#actions_layout{display:grid;grid-template-columns:1fr 1fr;gap:8px}.action-btn{padding:5px;cursor:pointer;background:#E1E1E1;border:1px solid #ADADAD;border-radius:2px}.action-btn:hover{background:#D4D4D4}#plots_panel{flex-grow:1;display:flex;background-color:#fff;border:1px solid #AAA;padding:0;position:relative}.plot-container{height:100%}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.4)}.modal-content{background-color:#fefefe;margin:5% auto;padding:20px;border:1px solid #888;width:80%;height:70%;display:flex;flex-direction:column}.modal-header{font-weight:700;margin-bottom:10px;font-size:16px}.modal-plot-area{flex-grow:1;width:100%;height:100%}</style></head><body><div id="main_widget"><div id="controls_panel"><div id="title_label">Controles</div><fieldset class="group-box"><legend>Mostrar/Ocultar Patrones</legend><div id="visibility_layout"></div></fieldset><fieldset class="group-box"><legend>Personalizar Trazas</legend><div id="style_layout"><div class="header label-col">Patrón</div><div class="header">Color</div><div class="header">Estilo</div></div></fieldset><fieldset class="group-box"><legend>Trazo de la Línea</legend><div id="linewidth_layout"><input type="range" id="linewidth_slider" min="1" max="5" step="1" value="2"> <span id="linewidth_label">2px</span></div></fieldset><fieldset class="group-box"><legend>Acciones</legend><div id="actions_layout"><button class="action-btn" id="btn_zoom_cart">Zoom Cartesiano</button> <button class="action-btn" id="btn_zoom_polar">Zoom Polar</button> <button class="action-btn" id="btn_export">Exportar Gráfico</button></div></fieldset></div><div id="plots_panel"><div id="cartesian_div" class="plot-container" style="width:65%"></div><div id="polar_div" class="plot-container" style="width:35%"></div></div></div><input type="color" id="global_color_picker" style="display:none"><div id="zoom_modal" class="modal"><div class="modal-content"><div id="modal_title" class="modal-header">Zoom</div><div id="modal_plot" class="modal-plot-area"></div><button onclick="document.getElementById('zoom_modal').style.display='none'" style="margin-top:10px">Cerrar</button></div></div><script>
(()=>{const d=document,w=window,M=Math,CF={d:{cart_min:-40,pol_min:-30,pol_max:0},lw:2,ls:{Continua:"solid",Punteada:"dash"},sn:{solid:"Continua",dash:"Punteada",dot:"Punteada"},cl:{Omnidireccional:"#0000FF","Cardioide Ancho":"#00FFFF",Cardioide:"#008000",Supercardioide:"#FF00FF",Hipercardioide:"#FFA500","Figura de 8":"#FF0000"}},SK="polar_plotter_settings";let ST={p:{},w:CF.lw,l:null,b:null};const ge=id=>d.getElementById(id),ce=tag=>d.createElement(tag),ln=(a,b,n)=>{let r=[],s=(b-a)/(n-1);for(let i=0;i<n;i++)r.push(a+s*i);return r},gp=lm=>{let pd={},dg=ln(-180,180,361),rd=dg.map(x=>x*M.PI/180),t2=ln(0,2*M.PI,361),d2=ln(0,360,361),o=Array(361).fill(1),cg=(A,B,T)=>T.map(t=>M.abs(A+B*M.cos(t))),fm={Omnidireccional:[o,o],"Cardioide Ancho":[cg(.63,.37,rd),cg(.63,.37,t2)],Cardioide:[cg(.5,.5,rd),cg(.5,.5,t2)],Supercardioide:[cg(.366,.634,rd),cg(.366,.634,t2)],Hipercardioide:[cg(.25,.75,rd),cg(.25,.75,t2)],"Figura de 8":[cg(0,1,rd),cg(0,1,t2)]},mc=M.pow(10,lm.cart_min/20),mp=M.pow(10,lm.pol_min/20),sp=lm.pol_max-lm.pol_min;for(let[k,v]of Object.entries(fm)){let gc=v[0],gp=v[1],cd=gc.map(x=>20*M.log10(M.max(x,mc))),ud=gp.map(x=>20*M.log10(M.max(x,mp))),rn=ud.map(x=>(M.min(M.max(x,lm.pol_min),lm.pol_max)-lm.pol_min)/sp);pd[k]={cd:cd,rn:rn,dc:dg,dp:d2}}return pd};function init(){ld();let r=gp(CF.d);for(let k in r)ST.p[k]||(ST.p[k]={v:!0,c:CF.cl[k]||"#000",s:"solid"}),Object.assign(ST.p[k],r[k]);vc();sc();sl();up()}function ld(){try{let s=localStorage.getItem(SK);if(s){let j=JSON.parse(s);ST.w=j.w||CF.lw,ST.p=j.p||{},ge("linewidth_slider").value=ST.w,ge("linewidth_label").innerText=ST.w+"px"}}catch(e){console.error(e)}}function sv(){let o={w:parseInt(ge("linewidth_slider").value),p:{}};for(let k in ST.p){let x=ST.p[k];o.p[k]={visible:x.v,color:x.c,linestyle:x.s}}localStorage.setItem(SK,JSON.stringify(o))}function vc(){let c=ge("visibility_layout");for(let k in CF.cl){let r=ce("div"),x=ce("input"),l=ce("label");x.type="checkbox",x.id="vis_"+k,x.checked=ST.p[k].v,x.onchange=e=>tg(k,e.target.checked),l.htmlFor="vis_"+k,l.innerText=" "+k,r.appendChild(x),r.appendChild(l),c.appendChild(r)}}function sc(){let c=ge("style_layout");for(let k in CF.cl){let p=ST.p[k],l=ce("div"),cd=ce("div"),b=ce("div"),cb=ce("button"),sb=ce("button");l.className="label-col",l.innerText=k,cd.style.textAlign="center",cb.className="color-btn",cb.style.backgroundColor=p.c,cb.onclick=()=>oc(k,cb),cd.appendChild(cb),b.style.textAlign="center",sb.className="style-btn",sb.innerText=CF.sn[p.s]||"Continua",sb.onclick=()=>ys(k,sb),b.appendChild(sb),c.appendChild(l),c.appendChild(cd),c.appendChild(b)}}function sl(){ge("linewidth_slider").oninput=e=>{ST.w=parseInt(e.target.value),ge("linewidth_label").innerText=ST.w+"px",up()},ge("global_color_picker").onchange=e=>{ST.l&&(nc(ST.l,e.target.value))},ge("btn_zoom_cart").onclick=()=>zm(!1),ge("btn_zoom_polar").onclick=()=>zm(!0),ge("btn_export").onclick=ex,w.onbeforeunload=()=>sv(),d.addEventListener("keydown",e=>{if((e.ctrlKey||e.metaKey)&&"s"===e.key)e.preventDefault(),ex()})}function tg(k,v){ST.p[k].v=v,up()}function oc(k,b){ST.l=k,ST.b=b;let p=ge("global_color_picker");p.value=ST.p[k].c,p.click()}function nc(k,h){ST.p[k].c=h,ST.b&&(ST.b.style.backgroundColor=h),up()}function ys(k,b){let curr=ST.p[k].s,nx="solid"===curr?"dash":"solid";ST.p[k].s=nx,b.innerText=CF.sn[nx],up()}function ly(){let f={family:"Arial",size:10,color:"#000"},ft={family:"Arial",size:12,color:"#000"};return{c:{title:{text:"Respuesta en Función del Ángulo de Incidencia",font:ft},xaxis:{title:{text:"Ángulo de Incidencia (Grados)",font:f},range:[-180,180],dtick:30,tickfont:f,gridcolor:"#d3d3d3",gridwidth:.6},yaxis:{title:{text:"Sensibilidad (dB)",font:f},range:[CF.d.cart_min,6],dtick:5,tickfont:f,gridcolor:"#d3d3d3"},margin:{l:50,r:20,t:40,b:40},paper_bgcolor:"#fff",plot_bgcolor:"#fff",showlegend:!0,legend:{x:.5,y:-.2,xanchor:"center",orientation:"h"}},p:{title:{text:"Diagrama Polar",font:ft},polar:{angularaxis:{direction:"counterclockwise",rotation:90,dtick:30,tickfont:f},radialaxis:{range:[0,1.1],showticklabels:!0,tickfont:f,tickmode:"array",tickvals:[0,.166,.333,.5,.666,.833,1],ticktext:["-30 dB","-25 dB","-20 dB","-15 dB","-10 dB","-5 dB","0 dB"]}},margin:{l:30,r:30,t:40,b:30},showlegend:!1}}}function up(){let tc=[],tp=[],l=ly();for(let k in CF.cl){let p=ST.p[k];p.v&&(tc.push({x:p.dc,y:p.cd,type:"scatter",mode:"lines",name:k,line:{color:p.c,width:ST.w,dash:p.s}}),tp.push({r:p.rn,theta:p.dp,type:"scatterpolar",mode:"lines",name:k,line:{color:p.c,width:ST.w,dash:p.s}}))}Plotly.react("cartesian_div",tc,l.c,{displayModeBar:!1,responsive:!0}),Plotly.react("polar_div",tp,l.p,{displayModeBar:!1,responsive:!0})}function zm(ip){let m=ge("zoom_modal"),tt=ge("modal_title");m.style.display="block",tt.innerText=ip?"Diagrama Polar (Zoom)":"Respuesta en Función del Ángulo (Zoom)";let tr=[];for(let k in CF.cl){let p=ST.p[k];p.v&&(ip?tr.push({r:p.rn,theta:p.dp,type:"scatterpolar",mode:"lines",name:k,line:{color:p.c,width:ST.w,dash:p.s}}):tr.push({x:p.dc,y:p.cd,type:"scatter",mode:"lines",name:k,line:{color:p.c,width:ST.w,dash:p.s}}))}let lay=ly(),sl=ip?lay.p:lay.c;sl.showlegend=!0,Plotly.newPlot("modal_plot",tr,sl,{responsive:!0})}function ex(){Plotly.downloadImage("cartesian_div",{format:"png",filename:"patron_polar_cartesiano"}),setTimeout(()=>Plotly.downloadImage("polar_div",{format:"png",filename:"patron_polar_circular"}),500),alert("Gráficos enviados a descarga (revise su carpeta de descargas).")}w.onload=init})()
</script></body></html>